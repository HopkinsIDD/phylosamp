---
title: <font size="5"> Estimating the sample size needed for variant monitoring </font>
subtitle: Cross-sectional sampling
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{V2: Estimating the sample size needed for variant monitoring (cross-sectional)}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

<style type="text/css">

h1.title {
  font-size: 18px
}

</style>

This vignette provides an overview of the functions that can be used to estimate the sample size needed to detect a pathogen variant or estimate its frequency in a population, given molecular characterization of a single cross-sectional sample of pathogen infections.

When the goal is detecting the presence or absence of a specific variant in a population, we can use the `calc_samplesize_detect()` function. Applying this function, however, requires knowledge of the coefficient of detection ratio between two pathogen variants (or, more commonly, one variant and the rest of the pathogen population). The coefficient of detection ratio for two variants can be calculated using the `calc_cod_ratio()` function. Since we are only interested in the ratio of the coefficients of detection, applying this function only requires providing parameters which are expected to differ between variants. The ratio between any variants not provided is assumed to be equal to one.

Once we have an estimate of the coefficient of detection ratio, we can calculate the sample size needed for detection from the following parameters:

| Param | Variable Name | <span style="display: inline-block; width:500px">Description</span> |
|:-----:|:-------------:|-------------|
|   **$P_{V_1}$**   |       p_v1       | the desired minimum variant prevalence to be able to detect           |
|   **$p$**   |       prob       | the desired probability of detection          |
|   **$\frac{C_{V_1}}{C_{V_2}}$**   |       c_ratio       | the coefficient of detection ratio, calculated as the ratio of the coefficients of variant 1 to variant 2 (can be calculated using `calc_cod_ratio()`)           |

We then apply this sample size calculation function as follows:

```{r setup, message=FALSE}
library(phylosamp)
```

```{r calc_samplesize_detect}

calc_samplesize_detect(p_v1=0.02, prob=0.95, c_ratio=1.368)

```

In other words, 109 sequences are needed to detect a variant at 2% (or higher) in a population with 95% of detection, given a coefficient of detection ratio ($\frac{C_{V_1}}{C_{V_2}}$) of 1.368. However, we also have to recognize that not all samples sequenced (or otherwise characterized) will be successful. If we assume an 80% success rate, for example, we need to collect and process 137 samples to ensure 109 high quality data points that can be used to detect the presence of a pathogen variant.

In some cases, it may not be enough to simply _detect_ a variant---we may want to estimate its frequency in the population. In that case, we can use the `calc_samplesize_prev()` function to determine the sample size needed to estimate the prevalence of a variant in a population given some desired precision. This function requires the user to specific a slightly different set of parameters:

| Param | Variable Name | <span style="display: inline-block; width:500px">Description</span> |
|:-----:|:-------------:|-------------|
|   **$P_{V_1}$**   |       p_v1       | the desired minimum variant prevalence to be able to detect           |
|   **$p$**   |       prob       | the desired probability of detection          |
|   **$d$**   |       precision       | the desired precision in the prevalence estimate          |
|   **$\frac{C_{V_1}}{C_{V_2}}$**   |       c_ratio       | the coefficient of detection ratio, calculated as the ratio of the coefficients of variant 1 to variant 2 (can be calculated using `calc_cod_ratio()`)           |

We then can calculate sample size as follows:

```{r calc_samplesize_prev}

c1_c2 <- calc_cod_ratio(alpha_v1=0.25, alpha_v2=0.4, beta_a=0.05, beta_s=0.3)
calc_samplesize_prev(p_v1=0.1,prob=0.95,precision=0.25,c_ratio=c1_c2)

```

In other words, 466 samples must be characterized in order to estimate the population prevalence of a variant with at least 10% prevalence in the population, with a precision of 25% of the true value, and a confidence of 95% in the prevalence estimate. Again, we must consider that not all samples sequenced (or otherwise characterized) will be successful. If we assume an 80% success rate, we need to collect and process 583 samples to ensure 466 high quality data points that can be used to detect the presence of a pathogen variant.