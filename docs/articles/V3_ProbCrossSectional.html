<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating the probability of detecting a variant • phylosamp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating the probability of detecting a variant">
<meta property="og:description" content="phylosamp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-173221313-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-173221313-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phylosamp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Transmission Linkage</li>
    <li>
      <a href="../articles/L1_FalseDiscoveryRate.html">Estimating the linkage false discovery rate</a>
    </li>
    <li>
      <a href="../articles/L2_SampleSize.html">Sample size calculations for transmission linkage</a>
    </li>
    <li>
      <a href="../articles/L3_SensitivitySpecificity.html">Estimating sensitivity and specificity of a linkage criteria</a>
    </li>
    <li>
      <a href="../articles/L4_IllustrativeExamples.html">Illustrative Examples</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Variant Tracking</li>
    <li>
      <a href="../articles/V1_CoefficientDetectionBias.html">Estimating bias in observed variant prevalence</a>
    </li>
    <li>
      <a href="../articles/V2_SampleSizeCrossSectional.html">Sample size calculations for variant tracking (cross-sectional sampling)</a>
    </li>
    <li>
      <a href="../articles/V3_ProbCrossSectional.html">Probability of detection and prevalence estimation (cross-sectional sampling)</a>
    </li>
    <li>
      <a href="../articles/V4_SampleSizePeriodic.html">Sample size calculations for variant tracking (periodic sampling)</a>
    </li>
    <li>
      <a href="../articles/V5_ProbDetectPeriodic.html">Probability of detection (periodic sampling)</a>
    </li>
    <li>
      <a href="../articles/V6_IllustrativeExample.html">Variant Surveillance Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HopkinsIDD/phylosamp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating the probability of detecting a
variant</h1>
            <h3 data-toc-skip class="subtitle">Cross-sectional
sampling</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/HopkinsIDD/phylosamp/blob/HEAD/vignettes/V3_ProbCrossSectional.Rmd" class="external-link"><code>vignettes/V3_ProbCrossSectional.Rmd</code></a></small>
      <div class="hidden name"><code>V3_ProbCrossSectional.Rmd</code></div>

    </div>

    
    
<p>In this vignette we discuss how the variant tracking functions can be
used in reverse, to calculate the probability or confidence of detection
(or effective prevalence estimation) given a fixed sample size. In other
words, if we have a pre-determined number of infections we can sequence
or otherwise characterize, we can use the <code>phylosamp</code> package
to determine the probability we will detect or correctly estimate the
prevalence of a known pathogen variant.</p>
<p>We can use the <code><a href="../reference/vartrack_prob_detect.html">vartrack_prob_detect()</a></code> function with the
<code>sampling_freq = "xsect"</code> option for calculating the
probability of detecting a circulating variant at a specific prevalence
level, given a cross-sectional sample of fixed size. Like it’s inverse
function (<code><a href="../reference/vartrack_samplesize_detect.html">vartrack_samplesize_detect()</a></code>), this function
requires knowledge of the coefficient of detection ratio between two
pathogen variants (or, more commonly, one variant and the rest of the
pathogen population). The coefficient of detection ratio for two
variants can be calculated using the <code><a href="../reference/vartrack_cod_ratio.html">vartrack_cod_ratio()</a></code>
function. Since we are only interested in the ratio of the coefficients
of detection, applying this function only requires providing parameters
which are expected to differ between variants. The ratio between any
variants not provided is assumed to be equal to one.</p>
<p>Once we have an estimate of the coefficient of detection ratio, we
can calculate the probability of detection from the following
parameters:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="42%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="center">Param</th>
<th align="center">Variable Name</th>
<th><span style="display: inline-block; width:500px">Description</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong><span class="math inline">\(P_{V_1}\)</span></strong></td>
<td align="center">p_v1</td>
<td>the desired minimum variant prevalence to be able to detect</td>
</tr>
<tr class="even">
<td align="center"><strong><span class="math inline">\(n\)</span></strong></td>
<td align="center">n</td>
<td>the sample size</td>
</tr>
<tr class="odd">
<td align="center"><strong><span class="math inline">\(\omega\)</span></strong></td>
<td align="center">omega</td>
<td>the sequencing success rate</td>
</tr>
<tr class="even">
<td align="center"><strong><span class="math inline">\(\frac{C_{V_1}}{C_{V_2}}\)</span></strong></td>
<td align="center">c_ratio</td>
<td>the coefficient of detection ratio, calculated as the ratio of the
coefficients of variant 1 to variant 2 (can be calculated using
<code><a href="../reference/vartrack_cod_ratio.html">vartrack_cod_ratio()</a></code>)</td>
</tr>
</tbody>
</table>
<p>We then apply this probability calculation function as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HopkinsIDD/phylosamp" class="external-link">phylosamp</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c1_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vartrack_cod_ratio.html">vartrack_cod_ratio</a></span><span class="op">(</span>phi_v1<span class="op">=</span><span class="fl">0.975</span>, phi_v2<span class="op">=</span><span class="fl">0.95</span>, gamma_v1<span class="op">=</span><span class="fl">0.8</span>, gamma_v2<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/vartrack_prob_detect.html">vartrack_prob_detect</a></span><span class="op">(</span>p_v1<span class="op">=</span><span class="fl">0.02</span>, n<span class="op">=</span><span class="fl">100</span>, omega<span class="op">=</span><span class="fl">0.8</span>, c_ratio<span class="op">=</span><span class="va">c1_c2</span>, sampling_freq<span class="op">=</span><span class="st">"xsect"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Calculating probability of detection assuming single cross-sectional sample</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0.8895872</span></span></code></pre>
<p>In other words, we have an 89% probability of detecting a variant at
2% (or higher) in a population given a sample size of 100 samples
selected for sequencing. In this calculation, we assumed that only 80%
(<span class="math inline">\(\omega=0.8\)</span>) of samples sequenced
(or otherwise characterized) are successful, leading to an effective
sample size of 80 samples. We also calculated a coefficient of detection
ratio (<span class="math inline">\(\frac{C_{V_1}}{C_{V_2}}\)</span>) of
1.368, which increased our confidence in detecting the variant, since we
expect it to be enriched in the population of detected infections.</p>
<p>In some cases, we may be more interested in correctly estimating the
variant frequency than simply stating its presence or absence in the
population. In this case, we can use the
<code><a href="../reference/vartrack_prob_prev.html">vartrack_prob_prev()</a></code> function to determine our confidence
in our estimate of variant prevalence given a fixed sample size. This
function requires the user to specific a slightly different set of
parameters:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="42%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="center">Param</th>
<th align="center">Variable Name</th>
<th><span style="display: inline-block; width:500px">Description</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong><span class="math inline">\(P_{V_1}\)</span></strong></td>
<td align="center">p_v1</td>
<td>the desired minimum variant prevalence</td>
</tr>
<tr class="even">
<td align="center"><strong><span class="math inline">\(n\)</span></strong></td>
<td align="center">n</td>
<td>the sample size</td>
</tr>
<tr class="odd">
<td align="center"><strong><span class="math inline">\(\omega\)</span></strong></td>
<td align="center">omega</td>
<td>the sequencing success rate</td>
</tr>
<tr class="even">
<td align="center"><strong><span class="math inline">\(d\)</span></strong></td>
<td align="center">precision</td>
<td>the desired precision in the prevalence estimate</td>
</tr>
<tr class="odd">
<td align="center"><strong><span class="math inline">\(\frac{C_{V_1}}{C_{V_2}}\)</span></strong></td>
<td align="center">c_ratio</td>
<td>the coefficient of detection ratio, calculated as the ratio of the
coefficients of variant 1 to variant 2 (can be calculated using
<code><a href="../reference/vartrack_cod_ratio.html">vartrack_cod_ratio()</a></code>)</td>
</tr>
</tbody>
</table>
<p>We then can calculate confidence in the estimated prevalence as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c1_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vartrack_cod_ratio.html">vartrack_cod_ratio</a></span><span class="op">(</span>alpha_v1<span class="op">=</span><span class="fl">0.25</span>, alpha_v2<span class="op">=</span><span class="fl">0.4</span>, beta_a<span class="op">=</span><span class="fl">0.05</span>, beta_s<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/vartrack_prob_prev.html">vartrack_prob_prev</a></span><span class="op">(</span>p_v1<span class="op">=</span><span class="fl">0.1</span>, n<span class="op">=</span><span class="fl">200</span>, omega<span class="op">=</span><span class="fl">0.8</span>, precision<span class="op">=</span><span class="fl">0.25</span>, </span>
<span>                   c_ratio<span class="op">=</span><span class="va">c1_c2</span>, sampling_freq<span class="op">=</span><span class="st">"xsect"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Calculating confidence in variant estimate assuming single cross-sectional sample</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0.7493082</span></span></code></pre>
<p>In other words, we can be 75% confident that any estimate of
prevalence of a variant we expect has at least 10% prevalence in the
population is within 25% of the true value, given a sample size of 200
samples. This takes into account the fact that we expect only 80% (<span class="math inline">\(\omega=0.8\)</span>) of these samples will be
successfully sequenced (or otherwise characterized). It also assumes
that our variant of interest has a lower asymptomatic rate than the rest
of the pathogen population (<span class="math inline">\(\alpha_{V_1}=0.25\)</span> vs <span class="math inline">\(\alpha_{V_2}=0.4\)</span>) and that the testing
probability of symptomatic infections (<span class="math inline">\(\beta_s=0.3\)</span>) is 6 times higher than the
testing probability of asymptomatic infections (<span class="math inline">\(\beta_a=0.05\)</span>), leading to a coefficient
of detection ratio of 1.187.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Shirlee Wohl, Elizabeth C Lee, John R Giles, Justin Lessler.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
